<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Portfolio</title>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible+Next:ital,wght@0,200..800;1,200..800&family=Noto+Sans+Symbols+2&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Libre+Barcode+128+Text&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Libre+Barcode+128&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=close,menu,translate" />
	<link rel="icon" href="./favicon.png" type="image/png">
	<link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180">

	<style>
		@font-face {
			font-family: 'neue';
			src: url('./HelveticaNeue-BoldExt.otf') format('opentype');
			font-weight: bold;
			font-style: normal;
		}
		
		.libre-barcode-128-text-regular {
			font-family: "Libre Barcode 128 Text", system-ui;
			font-weight: 400;
			font-style: normal;
		}
		
		.libre-barcode-128-regular {
			font-family: "Libre Barcode 128", system-ui;
			font-weight: 400;
			font-style: normal;
		}
		
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}
		button {
			all: unset;
			cursor: pointer;
		}
		html {
			background-color: #000;
			font-size: clamp(0.2rem, 1.48vw, .85rem);
		}
		body {
			display: flex;
			flex-direction: column;
			justify-content: start;
			align-items: center;
		}

		.visual {position: absolute;}

		.frame {
			position: relative;
		}
		.frame > img {
			width: 100%;
		}
		.toddao {
			width: 65rem;
			height: 23.75rem;
		}

		/* NEW: Hidden Dummy Frame */
		.dummy-frame {
			opacity: 0 !important;
			pointer-events: none !important;
			visibility: hidden; 
		}

		/* Project container - wraps button and video */
		.project-container {
			position: relative;
		}

		/* Vertical text overlays */
		.vertical-text-left {
			writing-mode: vertical-rl;
			position: absolute;
			top: 50%;
			left: -1.2rem;
			transform: translateY(-50%) rotate(180deg);
			z-index: 3;
			pointer-events: none;
		}

		.vertical-text-right {
			writing-mode: vertical-rl;
			position: absolute;
			top: 50%;
			right: -1.2rem;
			transform: translateY(-50%);
			z-index: 3;
			pointer-events: none;
		}

		.vertical-text-left span,
		.vertical-text-right span {
			text-orientation: mixed;
			font-size: 4rem;
			color: black;
			white-space: nowrap;
			letter-spacing: 0.1rem;
			display: block;
		}

		.vertical-text-left span > span,
		.vertical-text-right span > span {
			display: inline;
		}

		.frame button {
			position: absolute;
			transform: translate(-50%, -50%);
			top: 50%;
			left: 50%;
		}
		/* MODIFIED: Added will-change hint */
		.toddao button {
			will-change: height, transform; 
			width: 52.6rem;
			height: 23rem;
			transition: height 1s ease, transform 1s ease, filter 0.3s ease; 
			z-index: 1;
			border-radius: 1rem;
		}
		.toddao button.expanded {
			height: 70.5rem;
		}
		/* FIXED: Using translate3d for GPU acceleration */
		.toddao.move-up button {
			transform: translate3d(-50%, calc(-50% - 23.75rem), 0);
		}
		/* FIXED: Using translate3d for GPU acceleration */
		.toddao.move-down button {
			transform: translate3d(-50%, calc(-50% + 23.75rem), 0);
		}

		.frame button img {
			width: 100%;
			height: 100%;
			object-fit: cover;
			transition: opacity 0.5s ease;
			border-radius: 1rem;
		}
		.frame button {
			color: white;
			font-size: 8rem;
		}
		.frame button:hover {
			filter: brightness(1.1); 
			box-shadow: 
				0 0 0.5rem rgba(0,0,0,1),
				0 0 0.5rem rgba(0,0,0,1),
				0 0 0 0.1rem rgba(255,0,0,0.9);
		}

		/* YouTube Player Styles - MODIFIED */
		.youtube-container {
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			width: min(90%, 50rem);
			aspect-ratio: 16/9;
			/* Kept for fade-out, but placeholder makes content visible instantly */
			opacity: 0; 
			visibility: hidden;
			transition: opacity 0.5s ease, visibility 0.5s ease;
			z-index: 5000;
			pointer-events: none;
		}
		
		.youtube-container.show {
			opacity: 1;
			visibility: visible;
			pointer-events: auto;
		}
		
		.youtube-container iframe {
			width: 100%;
			height: 100%;
			border-radius: 1rem;
			border: none;
			box-shadow: 0 0 2rem rgba(0, 0, 0, 0.8);
			position: absolute; /* Needed for stacking on top of the placeholder */
			z-index: 2; /* Ensure iframe is on top */
			opacity: 0; /* Start hidden */
			transition: opacity 0.5s ease; /* Smooth transition for video appearance */
		}
		
		/* NEW: Placeholder Styles */
		.youtube-placeholder {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background-color: #333; /* Dark gray background */
			border-radius: 1rem;
			display: flex;
			justify-content: center;
			align-items: center;
			color: white;
			font-size: 4rem; /* Size of the 'VIDEO' text */
			font-family: "neue", sans-serif;
			z-index: 1; /* Ensure it is behind the iframe, but visible before it loads */
		}

		/* Description Styles */
		.project-description {
			position: absolute;
			top: 25rem;
			left: 50%;
			transform: translateX(-50%);
			width: min(90%, 50rem);
			background: rgba(0, 0, 0, 0.9);
			backdrop-filter: blur(1rem);
			-webkit-backdrop-filter: blur(1rem);
			color: white;
			padding: 1.5rem;
			border-radius: 1rem;
			font-size: 2rem;
			line-height: 1.4;
			opacity: 0;
			visibility: hidden;
			transition: opacity 0.5s ease, visibility 0.5s ease;
			z-index: 11;
			font-family: "Atkinson Hyperlegible Next", sans-serif;
			pointer-events: none;
		}
		
		.project-description.show {
			opacity: 1;
			visibility: visible;
			pointer-events: auto;
		}

		/* Navigation Header */
		header {
			position: fixed;
			top: 0;
			left: 50%;
			transform: translateX(-50%);
			width: 57.5rem;
			height: 10rem;
			z-index: 10001;
			display: flex;
			align-items: center;
			gap: 1rem;
			padding: 1rem;
			pointer-events: none;
		}

		/* Main Navigation - takes all available space */
		nav {
			flex: 1;
			background: rgba(240, 248, 255, 0.12);
			backdrop-filter: blur(1.5rem) saturate(1.3);
			-webkit-backdrop-filter: blur(1.5rem) saturate(1.3);
			border-radius: 1rem;
			box-shadow: 
				inset 0 0 0.1rem rgba(255, 255, 255, 0.2),
				0 0.3rem 1rem rgba(0, 0, 0, 0.1);
			border: 0.05rem solid rgba(255, 255, 255, 0.15);
			padding: 1rem;
			opacity: 1;
			pointer-events: none;
			transition: opacity 0.2s linear, pointer-events 0.2s linear;
		}

		nav.hide {
			opacity: 0;
			pointer-events: none;
		}
		
		nav.show {
			opacity: 1;
			pointer-events: auto;
		}
		
		nav ul {
			display: grid;
			grid-template-columns: 1fr 1fr 9rem;
			align-items: center;
			list-style: none;
			gap: 1rem;
			margin: 0;
			padding: 0;
			height: 100%;
		}
		
		nav button {
			background: rgba(255, 255, 255, 0.25);
			backdrop-filter: blur(0.5rem);
			-webkit-backdrop-filter: blur(0.5rem);
			padding: 1rem 0;
			font-family: "neue", sans-serif;
			font-weight: bold;
			border-radius: 1rem;
			line-height: 1;
			box-shadow: 
				inset 0 0.1rem 0 rgba(255, 255, 255, 0.3),
				0 0.2rem 0.5rem rgba(0, 0, 0, 0.1);
			text-shadow: 0 0 0.8rem rgba(255, 255, 255, 0.6);
			color: #000;
			font-size: 2.6rem;
			display: flex;
			justify-content: center;
			align-items: center;
			gap: 1rem;
			width: 100%;
			transition: all 0.2s ease;
			border: 0.05rem solid rgba(255, 255, 255, 0.2);
		}
		
		nav button:hover {
			background: rgba(255, 255, 255, 0.35);
			box-shadow: 
				inset 0 0.1rem 0 rgba(255, 255, 255, 0.4),
				0 0.3rem 0.8rem rgba(0, 0, 0, 0.15);
			text-shadow: 0 0 1.2rem rgba(255, 255, 255, 0.8);
		}

		/* Burger Menu Button - fixed width */
		.burger-button {
			flex-shrink: 0;
			width: 6rem;
			height: 6rem;
			background: rgba(200, 210, 220, 0.3);
			backdrop-filter: blur(1.5rem) saturate(1.2);
			-webkit-backdrop-filter: blur(1.5rem) saturate(1.2);
			border-radius: 1rem;
			font-family: "neue", sans-serif;
			font-weight: bold;
			box-shadow: 
				inset 0 0.1rem 0 rgba(255, 255, 255, 0.2),
				0 0.3rem 1rem rgba(0, 0, 0, 0.12);
			text-shadow: 0 0 0.8rem rgba(255, 255, 255, 0.7);
			color: #000;
			font-size: 2.6rem;
			display: flex;
			justify-content: center;
			align-items: center;
			transition: all 0.2s ease;
			border: 0.1rem solid rgba(255, 255, 255, 0.8);
			pointer-events: visible;
		}
		
		.burger-button:hover {
			background: rgba(220, 230, 240, 0.4);
			box-shadow: 
				inset 0 0.1rem 0 rgba(255, 255, 255, 0.3),
				0 0.4rem 1.2rem rgba(0, 0, 0, 0.15);
			text-shadow: 0 0 1.2rem rgba(255, 255, 255, 0.9);
		}

		.frame button span {
			position: absolute;
			bottom: 0;
			font-size: 2.5rem;
			color: white;
			background: rgba(0, 0, 0, .2);
			backdrop-filter: blur(0.3rem);
			-webkit-backdrop-filter: blur(0.3rem);
			z-index: 2;
			padding: 1rem;
			font-family: neue;
			line-height: 1;
			border-radius: 1rem;
		}
		.left {right:0;}
		.right {left:0}

		.material-symbols-outlined {
			font-variation-settings:'FILL' 0,'wght' 700,'GRAD' 0,'opsz' 48;
			font-size: 2.6rem;
			line-height: 1;
		}

		/* Hero Popup Styles */
		.hero-popup {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(0, 0, 0, 0.8);
			backdrop-filter: blur(1rem);
			-webkit-backdrop-filter: blur(1rem);
			z-index: 20000;
			display: flex;
			justify-content: center;
			align-items: center;
			opacity: 0;
			visibility: hidden;
			transition: opacity 0.3s ease, visibility 0.3s ease;
		}

		.hero-popup.show {
			opacity: 1;
			visibility: visible;
		}

		.hero-content {
			background: rgba(255, 255, 255, 0.1);
			backdrop-filter: blur(2rem) saturate(1.5);
			-webkit-backdrop-filter: blur(2rem) saturate(1.5);
			border: 0.1rem solid rgba(255, 255, 255, 0.2);
			border-radius: 2rem;
			box-shadow: 
				0 0 4rem rgba(0, 0, 0, 0.5),
				inset 0 0 2rem rgba(255, 255, 255, 0.1);
			width: min(90%, 80rem);
			max-height: 90vh;
			overflow-y: auto;
			position: relative;
			display: flex;
			flex-direction: column;
		}

		.hero-close {
			position: absolute;
			top: 2rem;
			right: 2rem;
			width: 6rem;
			height: 6rem;
			background: rgba(255, 0, 0, 0.6);
			backdrop-filter: blur(0.5rem);
			-webkit-backdrop-filter: blur(0.5rem);
			border-radius: 50%;
			display: flex;
			justify-content: center;
			align-items: center;
			z-index: 10;
			transition: all 0.2s ease;
			border: 0.1rem solid rgba(255, 255, 255, 0.3);
		}

		.hero-close:hover {
			background: rgba(255, 0, 0, 1);
			transform: scale(1.1);
		}

		.hero-close .material-symbols-outlined {
			color: white;
			font-size: 3rem;
		}

		.hero-image {
			width: 100%;
			height: auto;
			object-fit: cover;
			border-radius: 2rem 2rem 0 0;
		}

		.hero-text {
			padding: 4rem;
			color: white;
			font-family: "Atkinson Hyperlegible Next", sans-serif;
		}

		.hero-text h1 {
			font-family: "neue", sans-serif;
			font-size: 4rem;
			margin-bottom: 2rem;
			text-shadow: 0 0 2rem rgba(255, 255, 255, 0.3);
		}

		.hero-text p {
			font-size: 3rem;
			line-height: 1.6;
			text-shadow: 0 0 1rem rgba(0, 0, 0, 0.5);
			white-space: pre-line;
		}

		/* Scrollbar styling for popup */
		.hero-content::-webkit-scrollbar {
			width: 0.8rem;
		}

		.hero-content::-webkit-scrollbar-track {
			background: rgba(255, 255, 255, 0.1);
			border-radius: 0.4rem;
		}

		.hero-content::-webkit-scrollbar-thumb {
			background: rgba(255, 255, 255, 0.3);
			border-radius: 0.4rem;
		}

		.hero-content::-webkit-scrollbar-thumb:hover {
			background: rgba(255, 255, 255, 0.4);
		}
.ladder.strip {
    /* Offset by the height of one frame (23.75rem) to counter the dummy card's space */
    margin-top: -23.75rem; 
}
	</style>
</head>
<body>

	<header>
		<nav id="mainNav" class="show">
			<ul>
				<li><button onclick="openPopup('about')">About</button></li>
				<li><button onclick="openPopup('contact')">Contact</button></li>
				<li>
					<button>
						<span class="material-symbols-outlined">translate</span>
						<span style="font-size: 1.5rem;">(EN)</span>
					</button>
				</li>
			</ul>
		</nav>

		<button class="burger-button" id="burger" aria-expanded="false" aria-controls="mainNav" onclick="burgerClicked()">
			<span class="material-symbols-outlined">menu</span>
		</button>
	</header>

	<div class="hero-popup" id="aboutPopup">
		<div class="hero-content">
			<button class="hero-close" onclick="closePopup('about')">
				<span class="material-symbols-outlined">close</span>
			</button>
			<img class="hero-image" id="aboutImage" src="./media/group.jpg" alt="About">
			<div class="hero-text">
				<h1 id="aboutTitle">About</h1>
				<p id="aboutText">Welcome to my creative portfolio. I'm a designer and developer passionate about creating innovative digital experiences.</p>
			</div>
		</div>
	</div>

	<div class="hero-popup" id="contactPopup">
		<div class="hero-content">
			<button class="hero-close" onclick="closePopup('contact')">
				<span class="material-symbols-outlined">close</span>
			</button>
			<img class="hero-image" id="contactImage" src="./media/nodes.png" alt="Contact">
			<div class="hero-text">
				<h1 id="contactTitle">Contact</h1>
				<p id="contactText">Let's collaborate! Reach out to discuss your next project or just say hello.</p>
			</div>
		</div>
	</div>

	<div class="visual strip">
		<div class="toddao frame"><img src="toddao.svg"></div>
		<div class="toddao frame"><img src="toddao.svg"></div>
		<div class="toddao frame"><img src="toddao.svg"></div>
		<div class="toddao frame"><img src="toddao.svg"></div>
		<div class="toddao frame"><img src="toddao.svg"></div>
		<div class="toddao frame"><img src="toddao.svg"></div>
		<div class="toddao frame"><img src="toddao.svg"></div>
		<div class="toddao frame"><img src="toddao.svg"></div>
		<div class="toddao frame"><img src="toddao.svg"></div>
		<div class="toddao frame"><img src="toddao.svg"></div>
		<div class="toddao frame"><img src="toddao.svg"></div>
		<div class="toddao frame"><img src="toddao.svg"></div>
		<div class="toddao frame"><img src="toddao.svg"></div>
		<div class="toddao frame"><img src="toddao.svg"></div>
		<div class="toddao frame"><img src="toddao.svg"></div>
		<div class="toddao frame"><img src="toddao.svg"></div>
	</div>

	<div class="ladder strip">
		<div class="toddao frame"></div>
		
		<div class="toddao frame dummy-frame project-container">
			<button class="expanded" style="height: 70.5rem;"></button>
			<div class="youtube-container"></div>
			<div class="project-description"></div>
		</div>
		
		<div class="toddao frame"></div>
	</div>

	<script>
	// Load project data
	let projectsData = null;

	// Text variables
	const leftTextWord = "bar";
	const rightTextWord = "nim";

	// Image variables (replace with your actual images)
	const aboutImageSrc = "./media/group.jpg";
	const contactImageSrc = "./media/nodes.png";

	// Popup content translations
	const popupContent = {
		about: {
			en: {
				title: "About",
				text: "Brazilian living in Lisbon, Portugal. Passionate about filmmaking, photography, optics, architecture, and engineering.\nFormer student at ETIC Lisboa.\nFluent in English and Portuguese."
			},
			"pt-pt": {
				title: "Sobre",
				text: "Brasileiro a viver em Lisboa, Portugal. Apaixonado por cinema, fotografia, ótica, arquitetura e engenharia.\nEx-aluno da ETIC Lisboa.\nFluente em inglês e português."
			},
			zh: {
				title: "关于",
				text: "巴西人，现居葡萄牙里斯本。热爱电影制作、摄影、光学、建筑和工程。\nETIC-Lisboa前学生。\n精通英语和葡萄牙语。"
			},
			de: {
				title: "Über",
				text: "Brasilianer mit Wohnsitz in Lissabon, Portugal. Leidenschaftlich für Filmemachen, Fotografie, Optik, Architektur und Ingenieurwesen.\nEhemaliger Student der ETIC Lisboa.\nFließend in Englisch und Portugiesisch."
			},
			ar: {
				title: "حول",
				text: "برازيلي يعيش في لشبونة، البرتغال. شغوف بصناعة الأفلام والتصوير الفوتوغرافي والبصريات والهندسة المعمارية والهندسة.\nطالب سابق في ETIC-Lisboa.\nيتحدث الإنجليزية والبرتغالية بطلاقة."
			}
		},
		contact: {
			en: {
				title: "Contact",
				text: "Looking to collaborate or share ideas? Drop me a message- I'd love to connect.\n\nig: @val.nevs\nvaldir.nvs@outlook.com\n+351 930 946 697"
			},
			"pt-pt": {
				title: "Contacto",
				text: "Procura colaborar ou partilhar ideias? Envie-me uma mensagem - adoraria conectar.\n\nig: @val.nevs\nvaldir.nvs@outlook.com\n+351 930 946 697"
			},
			zh: {
				title: "联系",
				text: "想要合作或分享想法？给我留言吧 - 我很乐意与您联系。\n\nig: @val.nevs\nvaldir.nvs@outlook.com\n+351 930 946 697"
			},
			de: {
				title: "Kontakt",
				text: "Möchten Sie zusammenarbeiten oder Ideen austauschen? Schreiben Sie mir - ich würde mich freuen, von Ihnen zu hören.\n\nig: @val.nevs\nvaldir.nvs@outlook.com\n+351 930 946 697"
			},
			ar: {
				title: "اتصال",
				text: "تبحث عن التعاون أو مشاركة الأفكار؟ أرسل لي رسالة - سأكون سعيداً بالتواصل معك.  \n\nig: @val.nevs\nvaldir.nvs@outlook.com\n+351 930 946 697"
			}
		}
	};

	// Navigation translations
	const navTranslations = {
		"about": {
			"en": "About",
			"pt-pt": "Sobre",
			"zh": "关于",
			"de": "Über",
			"ar": "حول"
		},
		"contact": {
			"en": "Contact",
			"pt-pt": "Contacto",
			"zh": "联系",
			"de": "Kontakt",
			"ar": "اتصال"
		}
	};

	// Language cycling
	const languages = ['en', 'pt-pt', 'zh', 'de', 'ar'];
	const languageNames = {
		'en': 'EN',
		'pt-pt': 'PT',
		'zh': '中',
		'de': 'DE',
		'ar': 'ع'
	};
	let currentLanguage = 0;

	// Set images on load
	document.getElementById('aboutImage').src = aboutImageSrc;
	document.getElementById('contactImage').src = contactImageSrc;

	// Popup functions
	function openPopup(type) {
		const popup = document.getElementById(type + 'Popup');
		popup.classList.add('show');
		document.body.style.overflow = 'hidden';
	}

	function closePopup(type) {
		const popup = document.getElementById(type + 'Popup');
		popup.classList.remove('show');
		document.body.style.overflow = '';
	}

	// Close popup on background click
	document.getElementById('aboutPopup').addEventListener('click', (e) => {
		if (e.target === e.currentTarget) {
			closePopup('about');
		}
	});

	document.getElementById('contactPopup').addEventListener('click', (e) => {
		if (e.target === e.currentTarget) {
			closePopup('contact');
		}
	});

	// Close popup on Escape key
	document.addEventListener('keydown', (e) => {
		if (e.key === 'Escape') {
			document.querySelectorAll('.hero-popup.show').forEach(popup => {
				const type = popup.id.replace('Popup', '');
				closePopup(type);
			});
		}
	});

	// MODIFIED: loadProjectData now returns a promise for proper sequencing
	async function loadProjectData() {
		try {
			const response = await fetch('./data.json');
			projectsData = await response.json();
			generateProjects();
			updateLanguage();
			return Promise.resolve();
		} catch (error) {
			console.error('Error loading project data:', error);
			// Fallback data with test video and years
			projectsData = {
				"projects": [
					{
						"media": ["https://picsum.photos/800/600?random=1", "https://picsum.photos/800/600?random=2"],
						"videoId": "KUs1Popfd8g",
						"date": "2024/01",
						"duration": "30 MIN",
						"translations": {
							"en": ["Project One", "Camera"],
							"pt-pt": ["Projeto Um", "Câmara"],
							"zh": ["项目一", "摄影"],
							"de": ["Projekt Eins", "Kamera"],
							"ar": ["مشروع واحد", "كاميرا"]
						},
						"description": {
							"en": "This is a sample project with a video demonstration.",
							"pt-pt": "Este é um projeto exemplo com demonstração em vídeo.",
							"zh": "这是一个带有视频演示的示例项目。",
							"de": "Dies ist ein Beispielprojekt mit Videodemonstration.",
							"ar": "هذا مشروع عينة مع عرض فيديو."
						}
					},
					{
						"media": ["https://picsum.photos/800/600?random=3", "https://picsum.photos/800/600?random=4"],
						"videoId": "KUs1Popfd8g",
						"date": "2023/12",
						"duration": "10 MIN",
						"translations": {
							"en": ["Project Two", "Design"],
							"pt-pt": ["Projeto Dois", "Design"],
							"zh": ["项目二", "设计"],
							"de": ["Projekt Zwei", "Design"],
							"ar": ["مشروع اثنان", "تصميم"]
						},
						"description": {
							"en": "Another sample project showcasing design work.",
							"pt-pt": "Outro projeto exemplo mostrando trabalho de design.",
							"zh": "另一个展示设计工作的示例项目。",
							"de": "Ein weiteres Beispielprojekt mit Designarbeit.",
							"ar": "مشروع عينة آخر يعرض أعمال التصميم."
						}
					}
				]
			};
			generateProjects();
			updateLanguage();
			return Promise.resolve();
		}
	}

	function generateProjects() {
		if (!projectsData) return;
		
		const ladderStrip = document.querySelector('.ladder.strip');
		// The last child is the bottom spacer frame
		const lastFrame = ladderStrip.children[ladderStrip.children.length - 1];
		
		// Remove existing project frames (starting after the dummy frame at index 2)
		// We keep the two spacer frames and the dummy frame.
		while (ladderStrip.children.length > 3) {
			ladderStrip.removeChild(ladderStrip.children[2]);
		}
		
		// Generate project frames
		projectsData.projects.forEach((project, index) => {
			const frame = document.createElement('div');
			frame.className = 'toddao frame project-container';
			
			const button = document.createElement('button');
			const img = document.createElement('img');
			const leftSpan = document.createElement('span');
			const rightSpan = document.createElement('span');
			
			img.src = project.media[0];
			img.dataset.projectIndex = index;
			leftSpan.className = 'left';
			rightSpan.className = 'right';
			
			button.appendChild(img);
			button.appendChild(leftSpan);
			button.appendChild(rightSpan);
			frame.appendChild(button);
			
			// Add left vertical text overlay
			const verticalTextLeft = document.createElement('div');
			verticalTextLeft.className = 'vertical-text-left';
			const textSpanLeft = document.createElement('span');
			verticalTextLeft.appendChild(textSpanLeft);
			frame.appendChild(verticalTextLeft);
			
			// Add right vertical text overlay
			const verticalTextRight = document.createElement('div');
			verticalTextRight.className = 'vertical-text-right';
			const textSpanRight = document.createElement('span');
			verticalTextRight.appendChild(textSpanRight);
			frame.appendChild(verticalTextRight);
			
			// YouTube container - OUTSIDE the button
			const youtubeContainer = document.createElement('div');
			youtubeContainer.className = 'youtube-container';
			frame.appendChild(youtubeContainer);
			
			// Description container - OUTSIDE the button
			const descriptionDiv = document.createElement('div');
			descriptionDiv.className = 'project-description';
			frame.appendChild(descriptionDiv);
			
			ladderStrip.insertBefore(frame, lastFrame);
		});
		
		attachProjectListeners();
	}

	/**
	 * @description Handles loading the video placeholder, video iframe, and description visibility. 
	 * This is called *after* the card has expanded.
	 */
	function toggleMediaAndDescription(frame, projectIndex, expanded) {
		// Ensure projectIndex is valid
		if (projectIndex < 0 || projectIndex >= projectsData.projects.length) return;

		const project = projectsData.projects[projectIndex];
		const youtubeContainer = frame.querySelector('.youtube-container');
		const description = frame.querySelector('.project-description');
		
		if (expanded) {
			// Show YouTube video (or placeholder)
			if (project.videoId) {
				// 1. Insert Placeholder and Show Container immediately
				youtubeContainer.innerHTML = `
					<div class="youtube-placeholder">VIDEO</div>
				`;
				youtubeContainer.classList.add('show');
				
				// 2. Wait for the expansion animation (1s) before loading the iframe
				setTimeout(() => {
					const iframe = document.createElement('iframe');
					iframe.src = `https://www.youtube.com/embed/${project.videoId}?autoplay=0&rel=0&modestbranding=1`;
					iframe.frameBorder = "0";
					iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share";
					iframe.allowFullscreen = true;
					
					// 3. Listener to fade in the video once it loads
					iframe.onload = () => {
						// Fade in the iframe, covering the placeholder
						iframe.style.opacity = '1'; 
					};

					// Append iframe to container. It will cover the placeholder.
					youtubeContainer.appendChild(iframe);
				}, 1000); // Wait 1 second (matches CSS transition time)
			}
			
			// Show description
			setTimeout(() => {
				description.classList.add('show');
			}, 100);
		} else {
			// CLOSING
			// Hide YouTube video and description
			youtubeContainer.classList.remove('show');
			description.classList.remove('show');
			
			// Clear YouTube container content after it fades out (0.5s)
			setTimeout(() => {
				youtubeContainer.innerHTML = '';
			}, 500);
		}
	}

	function attachProjectListeners() {
		const ladderFrames = document.querySelectorAll('.ladder .toddao');

		ladderFrames.forEach((frame, index) => {
			const button = frame.querySelector('button');
			
			// Skip spacer frames and the dummy frame
			if (!button || frame.classList.contains('dummy-frame')) return;
			
			const img = button.querySelector('img');
			
			// CHANGED: Subtract 2 now (for the top spacer + the dummy card)
			const projectIndex = index - 2; 
			
			if (projectIndex < 0 || projectIndex >= projectsData.projects.length) return;
			
			const project = projectsData.projects[projectIndex];

			button.addEventListener('click', () => {
				const isExpanded = button.classList.contains('expanded');

				if (isExpanded) {
					// CLOSING - just collapse this one
					button.classList.remove('expanded');
					toggleMediaAndDescription(frame, projectIndex, false);
					frame.classList.remove('move-up', 'move-down');
					button.style.filter = ''; // Reset filter

					// Reset all move classes since nothing is expanded now
					ladderFrames.forEach((frm) => {
						frm.classList.remove('move-up', 'move-down');
					});
				} else {
					// OPENING
					
					// Step 1: Reset all positions and collapse others first
					ladderFrames.forEach((frm, frmIndex) => {
						const btn = frm.querySelector('button');
						if (btn) {
							// Collapse any other open card
							if (frm !== frame) {
								btn.classList.remove('expanded');
								toggleMediaAndDescription(frm, frmIndex - 2, false); // Use index - 2 for projects
							}
							// Reset all move classes
							frm.classList.remove('move-up', 'move-down');
							btn.style.filter = ''; // Reset filter
						}
					});

					// --- NEW LOGIC: Load Image Before Expanding ---
					
					const expandCard = () => {
						button.style.filter = ''; // Reset simple animation filter
						button.style.pointerEvents = 'auto'; // Re-enable clicks
						
						// 1. EXPAND the card (triggers CSS height transition)
						button.classList.add('expanded');
						
						// 2. Start video placeholder/loading/description
						toggleMediaAndDescription(frame, projectIndex, true);
						
						// 3. Apply new move classes based on the expanded frame
						ladderFrames.forEach((frm, frameIndex) => {
							if (frameIndex < index) {
								frm.classList.add('move-up');
							} else if (frameIndex > index) {
								frm.classList.add('move-down');
							}
						});
					};
					
					if (project.media[1]) {
						// Simple visual cue (dim the card) while loading
						button.style.filter = 'brightness(0.5)';
						
						const loadingImage = new Image();
						loadingImage.src = project.media[1];

						// Prevent double-clicking while the image is loading
						button.style.pointerEvents = 'none';

						loadingImage.onload = () => {
							// Set the image source after it's loaded
							img.src = project.media[1];
							expandCard();
						};

						loadingImage.onerror = () => {
							console.error(`Failed to load image: ${project.media[1]}. Expanding anyway.`);
							// Fallback: keep original image and expand
							expandCard();
						};

					} else {
						// No second media, expand immediately
						expandCard();
					}
					// ---------------------------------------------
				}
			});
		});
	}

	// NEW FUNCTION: Forces the first (dummy) card to expand and collapse
	function initializeLayoutWithDummyCard() {
		// 1. Find the dummy frame
		const dummyFrame = document.querySelector('.dummy-frame');
		if (!dummyFrame) return;

		const dummyIndex = Array.from(document.querySelectorAll('.ladder .toddao.frame')).indexOf(dummyFrame);
		
		// The dummy card is already 'expanded' in HTML to occupy space.
		// We simulate a 'close' action on it immediately (using its projectIndex, which is dummyIndex - 1)
		// This forces the full closing logic which cleans up the DOM and removes 'expanded' state.
		toggleMediaAndDescription(dummyFrame, dummyIndex - 1, false); 
		
		// Ensure the dummy button is fully reset after the initial work
		const dummyButton = dummyFrame.querySelector('button');
		if (dummyButton) {
			dummyButton.classList.remove('expanded');
		}
		dummyFrame.classList.remove('move-up', 'move-down');
	}


	function updateLanguage() {
		if (!projectsData) return;
		
		const lang = languages[currentLanguage];
		const langButton = document.querySelector('nav button span:last-child');
		langButton.textContent = `(${languageNames[lang]})`;

		// Update navigation
		const aboutButton = document.querySelector('nav ul li:first-child button');
		const contactButton = document.querySelector('nav ul li:nth-child(2) button');
		aboutButton.textContent = navTranslations.about[lang];
		contactButton.textContent = navTranslations.contact[lang];

		// Update popup content
		document.getElementById('aboutTitle').textContent = popupContent.about[lang].title;
		document.getElementById('aboutText').textContent = popupContent.about[lang].text;
		document.getElementById('contactTitle').textContent = popupContent.contact[lang].title;
		document.getElementById('contactText').textContent = popupContent.contact[lang].text;

		// Update project texts
		// Filter out the dummy frame
		const frames = document.querySelectorAll('.ladder .toddao.project-container:not(.dummy-frame)');
		frames.forEach((frame, index) => {
			// 'index' here corresponds directly to the project index (0, 1, 2, ...)
			const project = projectsData.projects[index];
			if (project) {
				const translations = project.translations[lang];
				const descriptionText = project.description[lang];
				
				const button = frame.querySelector('button');
				const leftSpan = button.querySelector('.left');
				const rightSpan = button.querySelector('.right');
				const descriptionDiv = frame.querySelector('.project-description');
				const verticalTextLeftSpan = frame.querySelector('.vertical-text-left span');
				const verticalTextRightSpan = frame.querySelector('.vertical-text-right span');
				
				if (leftSpan) leftSpan.textContent = translations[0];
				if (rightSpan) rightSpan.textContent = translations[1];
				if (descriptionDiv) descriptionDiv.textContent = descriptionText;
				
				// Update left vertical text
				if (verticalTextLeftSpan) {
					verticalTextLeftSpan.innerHTML = `<span class="libre-barcode-128-regular">${leftTextWord}</span><span class="libre-barcode-128-text-regular">${project.date}</span><span class="libre-barcode-128-regular">${leftTextWord}</span>`;
				}
				
				// Update right vertical text
				if (verticalTextRightSpan) {
					verticalTextRightSpan.innerHTML = `<span class="libre-barcode-128-regular">${rightTextWord}</span><span class="libre-barcode-128-text-regular">${project.duration}</span><span class="libre-barcode-128-regular">${rightTextWord}</span>`;
				}
			}
		});
	}

	function cycleLanguage() {
		currentLanguage = (currentLanguage + 1) % languages.length;
		updateLanguage();
	}

function burgerClicked() {
    const burger = document.getElementById('burger');
    const mainNav = document.getElementById('mainNav');
    const expanded = burger.getAttribute('aria-expanded') === 'true';
    burger.setAttribute('aria-expanded', !expanded);
    
    if (expanded) {
        // Closing - add hide class
        mainNav.classList.add('hide');
        mainNav.classList.remove('show');
    } else {
        // Opening - add show class, remove hide
        mainNav.classList.remove('hide');
        mainNav.classList.add('show');
    }
}

// Initialize
	document.addEventListener('DOMContentLoaded', () => {
		// CHANGED: Now using .then() to sequence the calls
		loadProjectData().then(() => {
			initializeLayoutWithDummyCard(); 
		});
	
		const translateButton = document.querySelector('nav ul li:last-child button');
		translateButton.addEventListener('click', cycleLanguage);
	
// Scroll listener to hide menu once
let hasScrolled = false;
window.addEventListener('scroll', () => {
    if (!hasScrolled && window.scrollY > 50) {
        hasScrolled = true;
        const mainNav = document.getElementById('mainNav');
        mainNav.classList.remove('show');
        mainNav.classList.add('hide');
    }
});
	});
	</script>

</body>
</html>